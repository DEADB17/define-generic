:SETTINGS:

#+AUTHOR:  DEADB17
#+EMAIL:   DEADB17@gmail.com
#+TITLE:   define-generic

#+OPTIONS:          H:4 num:nil toc:nil \n:nil ':t -:nil @:t ::t |:t ^:t f:t *:t <:t
#+OPTIONS:          TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:nil
#+OPTIONS:          html-style:nil html-scripts:nil html5-fancy:t
#+OPTIONS:          author:t email:t creator:nil
#+HTML_DOCTYPE:     html5
:END:

*  define-generic

Flexible JavaScript generic functions.

** DONE define core
** TODO define common dispatchers
*** on tag
#+begin_src js
  /*eslint-env commonjs*/
  /*eslint strict:0*/

  module.exports = function create(prop) {
      return {
          methods: {},
          getMethod: function getMethod(methods, args) {
              var key = args[0][prop];
              return methods[key];
          },
          setMethod: function setMethod(methods, args) {
              var fn = args[0];
              var key = args[1][prop];
              methods[key] = fn;
          }
      };
  };

#+end_src
*** on constructor function
#+begin_src js
  /*eslint-env commonjs*/
  /*eslint strict:0, no-plusplus:0*/

  var CONS = 0;
  var METH = 1;

  function indexOf(list, it, alt) {
      var n = list.length;
      var index = 0;
      while (index++ < n) if (list[index][CONS] === it) return index;
      return alt;
  }

  module.exports = {
      methods: [],
      getMethod: function getMethod(methods, args) {
          var cons = args[CONS];
          var index = indexOf(methods, cons, -1);
          return index >= 0 && methods[index][METH];
      },
      setMethod: function setMethod(methods, args) {
          var meth = args[0];
          var cons = args[1].constructor;
          var index = indexOf(methods, cons, methods.length);
          methods[index] = [ cons, meth ];
      }
  };

#+end_src
*** on constructor function name
** TODO define common appliers
** TODO add wrapping constructor
cases
- Argument validation
- Convenience constructors for common cases
- Augmented API
  - isDefined
  - getMethodFor
  - clone
** TODO describe how to extend
** TODO explain motivation